<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<meta https-equiv="Content-Type" content="text/html; charset=utf-8" />
	    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no, initial-scale=1">
		<meta name="screen-orientation" content="portrait"><!-- uc强制竖屏 -->
		<meta name="x5-orientation" content="portrait"><!-- QQ强制竖屏 -->
		<title>双十一抽奖活动</title>
		<style type="text/css">
		 * { padding:0; margin:0;-webkit-tap-highlight-color: rgba(0,0,0,0); box-sizing: border-box;}
		HTML ,body { font-size:12px;height:100%;width:100%; font-family: "Microsoft YaHei", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif;}
		li { list-style-type:none;}
		input, input[type="button"], input[type="submit"], input[type="reset"] {-webkit-appearance: none; color:slateblue; border:none; outline: none; background:transparent; width: 100%;}
		.wrapper{ width: 100%;min-height: 100%;background-color: #5d00c7;}
		.prize-type{ height: 105px; margin-top: -18px; padding: 0 15px;} 
		.timer{ margin: 28px  0 0; height: 180px; position: relative;}
		.timer .timer-title{ position: absolute; top: 12px; left: 0; width: 100%; height: 33px; line-height: 35px; font-size: 20px; font-weight: 400; color: #00fcff;}
		.timer .timer-num{ position: absolute; top: 0; left: 53%;}
		.timer .timer-text{ position: absolute; top: 70px; left: 0; width: 100%; text-align: center; }
		.timer .timer-text-order{ font-size: 18px; line-height: 60px; color: #fff; }
		.timer .timer-text-order .order-num{ font-weight: 600; color: #ffea00;}
		.timer .timer-text-more{ font-size: 16px; color: #d4aeff; }
		.draw{ position: relative; height: 340px; margin-top: 22px; }
		.draw .draw-bg{ position: absolute; width: 92%; height: 340px; left: 4%; }
		.draw .twinkle-bg{animation: twinkle 1s infinite;}
		@keyframes twinkle {
		  0% {
		    opacity: 0;
		  }
		  100% {
		    top: 1;
		  }
		}
		.draw .draw-box-btn{ position: relative; top: 50px; left: 33%; z-index: 10;  width: 34%; }
		.draw .draw-box{ margin-bottom: 10px; }
		.draw .draw-prize{ position: absolute; top: 2%; right: 8%; width: 34%; z-index: 10; animation: pop 1s infinite;}
		@keyframes pop {
		  0% {
		    top: 2%;
		  }
		  50% {
		    top: 1.5%;
		  }
		  100% {
		    top: 2.5%;
		  }
		}
		.lucky-list{ position: relative; left: 4%; margin-top: 18px; height: 500px; width: 92%; }
		.lucky-list .lucky-title{ position: absolute; top: 0; left: 20%; width: 60%; z-index: 10; }
		.lucky-list .lucky-bg{ position: absolute; top: 6%; width: 98%; height: 450px; overflow-y: hidden; padding:30px 0 10px; background: #6844eb; border-radius: 10px; text-align: center; font-size: 16px; line-height: 30px; }
		.lucky-list .lucky-bg .list-body{ overflow-y: scroll; height: 380px; }
		.lucky-list .lucky-bg .list-title .cell{ color: #fff; display: inline-block; }
		.lucky-list .lucky-bg .list-item .cell{ color: #d4aeff; height: 30px; display: inline-block; overflow: hidden; }
		.lucky-list .lucky-bg .name{ width: 25%; }
		.lucky-list .lucky-bg .tel{ width: 35%; }
		.lucky-list .lucky-bg .prize{ width: 36%; }
		
		.mask-wrapper{ position: fixed; top: 0; left: 0;  width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 20; }
		.mask-wrapper .mask-inner{ position: absolute; width: 86%; top: 23%; left: 7%; }
		.mask-wrapper .mask-inner .mask-prize{ position: absolute; top: 20%; width: 100%; text-align: center; font-size: 16px; height:16px; color: yellow; }
		.mask-wrapper .mask-inner .mask-btn{ position: absolute; width: 80%; left: 10%; top: 76%; height: 46px; }
		
		.mask-wrapper .mask-inner .mask-tel-id{ position: absolute; width: 45%; left: 38%; top: 54%; height: 60px; line-height: 28px; }
		.mask-wrapper .mask-inner .mask-btn-login{ position: absolute; top: 77%; left: 10%; width: 80%; }
		.toast{ position: fixed; top: 35%; left: 10%; width: 80%; height: 40px; line-height: 40px; background: rgba(0,0,0,0.5); color: #fff; z-index: 30; text-align: center; border-radius: 10px;font-size: 18px;}
		</style>
		
		<!--<script src="https://i1.Yongche.name/s/js/201711/jsonp.js?1478153218"></script>-->
		<script src="https://i3.Yongche.name/s/js/201711/vue.min.js?1478153218"></script>
		<script type="text/javascript" src="js/jquery-2.0.0.min.js"></script>
		<!--<script src="<{asset:js/jquery/jquery-1.8.3.min.js}>"></script>-->	
	</head>
	<body>
		<div id="app">
			<div class="wrapper">
				<div class="head">
					<img src="https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9ijuISw2EAAHOMyBp9-oAAKAoAFgvq8AAc5L865.png" width="100%"/>
				</div>
				<div class="prize-type">
					<img v-bind:src="currentPrizeType" width="100%"/>
				</div>
				<div class="timer">
					<img src="https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9jUuINVAmAAAVlT9bEuoAAKAoAIfg9sAABWt928.png" width="100%" height="100%"/>
					<div class="timer-title">
						<img class="timer-title-img" src="https://i2.Yongche.name/media/g2/M01/19/2E/rBEBJVn9jUyIMi_YAAALCn58uDoAAKAoQF2EpUAAAsi746.png" width="90%" height="100%"/>
						<span id="timer-num" class="timer-num" v-html="countdown"></span>
					</div>
					<div class="timer-text">
						<div class="timer-text-order">当前完成“随叫随到”订单数<span id="order-num" class="order-num" v-html="orderNums"></span>单</div>
						<div class="timer-text-more">完成订单越多，中奖率越高</div>
					</div>
				</div>
				<div class="draw">
					<div class="draw-bg">
						<img src="https://i3.Yongche.name/media/g2/M01/19/2E/rBEBP1n9inSII26qAADrqxKdIEcAAKAoQCMYtQAAOvD582.png" width="100%" height="100%" />
					</div>
					<div class="draw-bg twinkle-bg">
						<img src="https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9inSISMNKAADijC5dHZEAAKAoAFt5AUAAOKk133.png" width="100%" height="100%" />
					</div>
					<div class="draw-box-btn">
						<div class="draw-box">
							<img src="https://i2.Yongche.name/media/g2/M02/19/2E/rBEBP1n9iK-ISAheAABA8SMeGqcAAKAoADpgQIAAEEJ539.png" width="100%"/>
						</div>
						<div class="draw-btn" @click=getResult>
							<img v-bind:src="drawBtnState" width="100%"/>
						</div>
					</div>
					<div class="draw-prize">
						<img v-bind:src="currentDrawPrizeType" width="100%"/>
					</div>
				</div>
				<div class="lucky-list">
					<div class="lucky-title">
						<img src="https://i3.Yongche.name/media/g2/M01/19/2E/rBEBJVn9iq6IM1hLAAAVywUdO_IAAKAoQCwXpEAABXj514.png" width="100%"/>
					</div>
					<div class="lucky-bg">
						<div class="list-title">
							<div class="cell name">姓名</div>
							<div class="cell tel">手机号</div>
							<div class="cell prize">奖品</div>
						</div>
						<div class="list-body">
							<div class="list-item" v-for="item in luckyList">
								<div class="cell name" v-html="item.name"></div>
								<div class="cell tel" v-html="item.cellphone"></div>
								<div class="cell prize" v-html="toPrize(item.award_type)"></div>
							</div>
						</div>
						
					</div>
				</div>
			</div>
			<div class="mask-wrapper" v-show="showMask && isLogin">
				<div class="mask-inner">
					<div class="mask-bg">
						<img v-bind:src="showMaskBg" width="100%"/>
					</div>
					<div class="mask-prize" v-html="winPrize"></div>
					<div class="mask-btn" v-show="isLogin" @click=closeMask>
						<img src="https://i3.Yongche.name/media/g2/M03/19/2E/rBEBJVn9jHyIe_znAAArBrpqmz0AAKAngOXaswAACse777.png" width="100%"/>
					</div>
				</div>
			</div>
			<div class="mask-wrapper" v-show="showMask && !isLogin">
				<div class="mask-inner">
					<div class="mask-bg">
						<img v-bind:src="showMaskBg" width="100%"/>
					</div>
					<div class="mask-tel-id">
						<div class="mask-tel">
							<input type="number" name="tel" placeholder="请输入手机号" oninput="if(value.length>11)value=value.slice(0,11)" v-model="telNum" />
						</div>
						<div class="mask-id">
							<input type="number" name="idcard" placeholder="请输入身份证后四位" oninput="if(value.length>4)value=value.slice(0,4)" v-model="idCard" />
						</div>
					</div>
					<div class="mask-btn-login" @click=login>
						<img src="https://i2.Yongche.name/media/g2/M01/19/32/rBEBP1oCYr2ICTCkAAAUf8XeqScAAKB-QP98R8AABSX984.png" width="100%"/>
					</div>
				</div>
			</div>
			<div class="toast" v-show="showToast" v-html="toastMsg"></div>
		</div>
			
<script type="text/javascript">
alert(111)
$.ajax({
     type: "GET",
     url: "http://testing-market.Yongche.org/miscellaneous/DoubleEleven/getInitPage?driver_id=50056790",
     dataType:'jsonp',
     crossDomain:true, // ios系统必须这样用，否则https无法正确通信
     jsonp:'callback',
     success: function(data){
     	alert(50056790)
     	if(data.code==200){
     		alert(50056790)
     		
        }
      },
      error:function(e){
        alert(JSON.stringify(e));
      }
});
        
  console.log(Vue);      
new Vue({
  el: '#app',
  data:{
	timeStamps:[],
  	countdown: "00:00:00",
  	offset: 0,
  	interval: null,
  	currentTimeStamp:0,
  	currentTimeRange:0,
  	prizeTypes:["https://i3.Yongche.name/media/g2/M01/19/2E/rBEBP1n9jQeIRTU3AABDWUSUIFAAAKAoQE6H04AAENx814.png","https://i1.Yongche.name/media/g2/M01/19/2E/rBEBJVn9jQeIWO7LAABBEXbdda8AAKAoQE6Yr8AAEEp603.png","https://i1.Yongche.name/media/g2/M01/19/2E/rBEBJVn9jQeIK5lrAABDo5u2XScAAKAoQE6o-gAAEO7103.png","https://i1.Yongche.name/media/g2/M01/19/2E/rBEBP1n9jUuIOlC5AABCjgC2J_4AAKAoQF1z-8AAEKm317.png","https://i2.Yongche.name/media/g2/M01/19/2E/rBEBP1n9jQeIWrOUAABGFFsrpUsAAKAoQE52SIAAEYs739.png"],
  	drawPrizeTypes:["https://i1.Yongche.name/media/g2/M01/19/2E/rBEBJVn9iq6IVSywAAAdgz8Azy8AAKAoQCwIm0AAB2b314.png","https://i2.Yongche.name/media/g2/M02/19/2E/rBEBP1n9iq2IKpUBAAAhpZ1MZlMAAKAoAGAcdIAACG9800.png","https://i3.Yongche.name/media/g2/M01/19/2E/rBEBP1n9iq2IBBU2AAAecXiHi2QAAKAoQCwQAgAAB6J497.png","https://i2.Yongche.name/media/g2/M02/19/2E/rBEBP1n9iq2IKpUBAAAhpZ1MZlMAAKAoAGAcdIAACG9800.png","http://i3.yongche.name/media/g2/M04/19/33/rBEBJVoCxrWIIT1GAAAgE2oEotEAAKCawIzUSQAACAr317.png"],
  	drawBtnTypes:["https://i2.Yongche.name/media/g2/M01/19/2E/rBEBJVn9iq6IQ0XOAAAU6wIkjlcAAKAoQCwDWoAABUD275.png","https://i1.Yongche.name/media/g2/M02/19/2E/rBEBP1n9iq2IHZKGAAAU3ilU2-oAAKAoAGAXNwAABT2072.png","https://i3.Yongche.name/media/g2/M04/19/2E/rBEBJVn9iK-IUMaFAAAVy5rudWgAAKAnwKiOWsAABXj236.png"],
  	maskBgs:["https://i3.Yongche.name/media/g2/M03/19/32/rBEBJVoCYMyIELiVAAN5o9ioJSMAAKB-wG2NrcAA3m7481.png","https://i2.Yongche.name/media/g2/M03/19/2E/rBEBP1n9jHyIGo_YAARTK_MEi3gAAKAngOg7PoABFND414.png","https://i3.Yongche.name/media/g2/M03/19/2E/rBEBP1n9jHyIOz8UAAScoI6fLKkAAKAngOcUEIABJy4206.png","https://i2.Yongche.name/media/g2/M03/19/2E/rBEBJVn9jHyIGQE_AAS6QNu_Uh0AAKAngOXleoABLpY886.png"],
  	isLogin:0,
  	telNum:null,
  	idCard:null,
  	isClick:0,
	orderNums:0,
	drawBtn:false,
	luckyList:[],
	showMask:false,
	maskType:0,
	winPrize:"",
	showToast:false,
	toastMsg:"",
	driver_id:0
  },
  computed:{
  	currentPrizeType:function(){
  		var idx = this.currentTimeRange;
		return this.prizeTypes[idx];
  	},
  	currentDrawPrizeType:function(){
  		var idx = this.currentTimeRange;
		return this.drawPrizeTypes[idx];
  	},
  	drawBtnState:function(){
  		var idx = this.isClick+1;
  		return this.drawBtnTypes[idx];
  	},
  	showMaskBg:function(){
  		var idx = this.isLogin==0 ? 0 : this.maskType;
		return this.maskBgs[idx];
  	}
  },
  mounted: function(){
	this.initData();
  },
  methods:{
  	login:function(){//登录，传手机号和身份证后四位
  		var vm = this;
		if(!vm.telNum || !vm.idCard){
			vm.showToast = true;
     		vm.toastMsg="手机号或身份证不能为空";
     		setTimeout(function(){
     			vm.showToast = false;
     		},2000)
     		return
		}
		$.ajax({
             type: "GET",
             url: "//testing.market.Yongche.org/miscellaneous/DoubleEleven/login?cellphone="+vm.telNum+"&id_card="+vm.idCard,
             dataType:'jsonp',
             crossDomain:true, // ios系统必须这样用，否则https无法正确通信
             jsonp:'callback',
             success: function(data){
             	if(data.code==200 &&data.result.status==1){
	         		vm.showMask=false;
	         		vm.driver_id = data.result.driver_id;
	         		vm.initData();//刷新页面
	            }else{//登录信息错误不可抽奖
	            	vm.showToast = true;
	         		vm.toastMsg=data.msg;
	         		setTimeout(function(){
	         			vm.showToast = false;
	         		},2000)
	            }
              },
              error:function(e){
                alert(JSON.stringify(e));
              }
        });
        
  		/*JSONP.init({
  			error:function(ex){
  				alert("Failed to load:" + ex.url);
  			}
  		})
		JSONP.get("//yaoyakun.market.Yongche.org/miscellaneous/DoubleEleven/login?cellphone="+vm.telNum+"&id_card="+vm.idCard, function (data) {
   			if(data.code==200 &&data.result.status==1){
         		vm.showMask=false;
         		vm.driver_id = data.result.driver_id;
         		vm.initData();//刷新页面
            }else{//登录信息错误不可抽奖
            	vm.showToast = true;
         		vm.toastMsg=data.msg;
         		setTimeout(function(){
         			vm.showToast = false;
         		},2000)
            }
 		});*/
  	},
  	initData:function (){// 获取随叫随到订单数
  		var vm = this;
  		$.ajax({
             type: "GET",
             url: "//testing.market.Yongche.org/miscellaneous/DoubleEleven/getInitPage?driver_id="+vm.driver_id,
             dataType:'jsonp',
             crossDomain:true, // ios系统必须这样用，否则https无法正确通信
             jsonp:'callback',
             success: function(data){
             	if(data.code==200){
	         		console.log(data)
	         		vm.isLogin = data.result.isLogin;
	          		if(vm.isLogin==0){
	           			vm.showMask=true;
	          		}
	          		vm.timeStamps = vm.toTimeStamp(data.result.dateTimes);
	         		vm.orderNums = data.result.count;
	         		vm.currentTimeStamp = data.result.currentTimeStamp;
	         		vm.currentTimeRange = data.result.currentTimeRange;
	         		vm.isClick = data.result.isClick;
	         		vm.luckyList = data.result.driverList;
	         		
	         		vm.getOffsetTimeStamps();
	            }
              },
              error:function(e){
                alert(JSON.stringify(e));
              }
        });
  		/*JSONP.init({
  			error:function(ex){
  				alert("Failed to load:" + ex.url);
  			}
  		})
		JSONP.get("//yaoyakun.market.Yongche.org/miscellaneous/DoubleEleven/getInitPage?driver_id="+vm.driver_id, function (data) {
   			if(data.code==200){
         		console.log(data)
         		vm.isLogin = data.result.isLogin;
          		if(vm.isLogin==0){
           			vm.showMask=true;
          		}
          		vm.timeStamps = vm.toTimeStamp(data.result.dateTimes);
         		vm.orderNums = data.result.count;
         		vm.currentTimeStamp = data.result.currentTimeStamp;
         		vm.currentTimeRange = data.result.currentTimeRange;
         		vm.isClick = data.result.isClick;
         		vm.luckyList = data.result.driverList;
         		
         		vm.getOffsetTimeStamps();
            }
 		});*/
	},
	getResult:function(){//点击抽奖
		if(this.isClick<=0){//不可以抽奖
			return
		}
		this.isClick = -1//已经点击过了
		var vm = this;
		$.ajax({
             type: "GET",
             url: "//yaoyakun.market.Yongche.org/miscellaneous/DoubleEleven/getResult?driver_id="+vm.driver_id,
             dataType:'jsonp',
             crossDomain:true, // ios系统必须这样用，否则https无法正确通信
             jsonp:'callback',
             success: function(data){
             	if(data.code==200){//中奖了
	         		vm.maskType=1;
	         		vm.winPrize=data.msg;
	         	}else if(data.code==204){//未中奖
	         		vm.maskType=2
	         	}else if(data.code==205){//请完成随叫随到订单后再来抽奖
	         		vm.maskType=3
	         	}else{
	         		vm.maskType=2;
	         	}
	         	vm.showMask=true;
	         	vm.initData();//刷新页面
              },
              error:function(e){
                alert(JSON.stringify(e));
              }
        });
        
		/*JSONP.init({
  			error:function(ex){
  				alert("Failed to load:" + ex.url);
  			}
  		})
		JSONP.get("//yaoyakun.market.Yongche.org/miscellaneous/DoubleEleven/getResult?driver_id="+vm.driver_id, function (data) {
   			
         	if(data.code==200){//中奖了
         		vm.maskType=1;
         		vm.winPrize=data.msg;
         	}else if(data.code==204){//未中奖
         		vm.maskType=2
         	}else if(data.code==205){//请完成随叫随到订单后再来抽奖
         		vm.maskType=3
         	}else{
         		vm.maskType=2;
         	}
         	vm.showMask=true;
         	vm.initData();//刷新页面
 		});*/
	},
	closeMask:function(){
		this.showMask=false;
	},
	toPrize:function(num){
		if(num===0){
			return "充电宝";
		}else if(num==2){
			return "净化器";
		}else{
			return "免佣金";
		}
	},
	getOffsetTimeStamps: function(){
		if(this.currentTimeRange==4){
			this.countdown = "00:00:00";
			return;
		}
		this.offset = this.timeStamps[this.currentTimeRange] - this.currentTimeStamp;
		this.getCountdown();
	},
	getCountdown: function(){
		var vm = this;
		// 根据时间戳差值计算时分秒
		var hour = Math.floor(vm.offset / (60 * 60));
		var min = Math.floor(vm.offset / 60 % 60);
		var sec = Math.floor(vm.offset % 60);
		hour = hour<10 ? "0"+hour : hour;
		min = min<10 ? "0"+min : min;
		sec = sec<10 ? "0"+sec : sec;
		vm.countdown = hour+":"+min+":"+sec;
		if(!vm.interval && vm.offset > 0){
			vm.interval = window.setInterval(function(){
				vm.offset--;
				vm.getCountdown();
				if(vm.offset<=0){
					vm.isClick= 1;//可以点击抽奖了
					window.clearInterval(vm.interval);
				}
			}, 1000);
		}
	},
	toTimeStamp:function (arr){
		var times = [];
		arr.forEach(function(item){
		    times.push(Date.parse(new Date(item)) / 1000);
		})
		return times;
	}
 }
})


</script>
	</body>
</html>
